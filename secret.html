<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ÆGIRSON CHRONICLES: The Lustful Cauldron Quest</title>
<style>
    :root {
        --bg-color: #050505;
        --term-green: #33ff33;
        --term-dim: #1a801a;
        --glow: 0 0 10px rgba(51, 255, 51, 0.7);
        --scan-color: rgba(0, 0, 0, 0.5);
    }
    body {
        background-color: var(--bg-color);
        color: var(--term-green);
        font-family: 'Courier New', Courier, monospace;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: auto; /* allow page scrolling on small screens */
        display: flex;
        justify-content: center;
        text-shadow: 0 0 2px var(--term-dim);
    }
    /* CRT Scanline Effect */
    .scanlines {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                    linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
        background-size: 100% 4px, 3px 100%;
        pointer-events: none;
        z-index: 999;
    }
    #terminal {
        width: 100%;
        max-width: 800px;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    #output {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 120px; /* leave room for mobile keyboard / controls */
        white-space: pre-wrap;
        scrollbar-width: none; /* Firefox */
        font-size: 16px;
        line-height: 1.4;
    }
    #output::-webkit-scrollbar { display: none; }
    
    .input-line {
        display: flex;
        align-items: center;
        border-top: 1px solid var(--term-dim);
        padding-top: 10px;
        background: var(--bg-color);
    }
    .prompt { margin-right: 10px; font-weight: bold; }
    #cmd {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--term-green);
        font-family: inherit;
        font-size: 18px;
        outline: none;
        /* keep native caret for accessibility */
    }
    .cursor {
        display: inline-block;
        width: 10px;
        height: 18px;
        background-color: var(--term-green);
        animation: blink 1s step-end infinite;
        vertical-align: text-bottom;
        margin-left: -10px; /* Overlap input caret */
        pointer-events: none;
    }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

    /* Utility Classes */
    .highlight { color: #ccffcc; text-shadow: var(--glow); font-weight: bold; }
    .error { color: #ff3333; }
    .item { color: #ffff33; }
    .room-title { border-bottom: 1px dashed var(--term-green); margin-bottom: 10px; padding-bottom: 5px; display:inline-block; font-weight:bold; letter-spacing: 2px;}
    .ascii-art { font-size: 10px; line-height: 10px; color: var(--term-dim); margin: 10px 0; }
    .hud { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.45); border: 1px solid var(--term-dim); padding: 6px 10px; border-radius: 6px; font-size: 13px; z-index: 20; }
    .mobile-controls{ display:flex; gap:8px; margin-top:10px; }
    .mobile-btn{ background: transparent; color: var(--term-green); border:1px solid var(--term-dim); padding:6px 8px; border-radius:6px; font-family:inherit; }
    
    /* Win Confetti */
    .confetti { position: absolute; width: 5px; height: 5px; background: var(--term-green); animation: fall 3s linear forwards; }
    @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }

</style>
</head>
<body>

<div class="scanlines"></div>
    <div id="terminal">
    <div id="output"></div>
    <div id="hud" class="hud" aria-hidden="false">Arousal: 100 | Orgasms: 0 | Toys: 0</div>
    <div class="input-line" id="input-area" style="display:none;">
        <span class="prompt">ÆGIRSON_LUST></span>
        <input type="text" id="cmd" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" aria-label="Game input" role="textbox">
        <span class="cursor"></span>
    </div>
    <div class="mobile-controls" aria-hidden="false">
        <button class="mobile-btn" onclick="printRoom()">Look</button>
        <button class="mobile-btn" onclick="showInv()">Inventory</button>
        <button class="mobile-btn" onclick="showHelp()">Help</button>
    </div>
</div>

<script>
/**
 * ÆGIRSON CHRONICLES: The Lustful Cauldron Quest
 * Single File Game Engine & Data - Erotic Edition
 */

// --- STATE MANAGEMENT ---
const GAME_ID = 'AegirsonLust_v1';
let state = {
    room: 'home',
    inventory: [],
    arousal: 100,
    orgasms: 0,
    visited: [],
    flags: {
        gameWon: false,
        trollFucked: false,
        lanternLit: false,
        flaskFilled: false,
        ropeTied: false,
        riddleSolved: false,
        krakenFucked: false,
        doorOpen: false
    }
};

const MAX_INV = 5;

// --- GAME DATA ---

const items = {
    photo: { name: "Erotic Portrait", desc: "A steamy nude portrait of your voluptuous lover by the Godafoss falls. Her curves make your cock twitch.", type: "misc", pleasure: 20 },
    sword: { name: "Phallic Dildo Sword", desc: "A vibrating blade-shaped dildo, perfect for thrusting into tight spots.", type: "toy", power: 15 },
    lantern: { name: "Glowing Vibrator Lantern", desc: "Emits a pulsating green glow that warms and teases your skin.", type: "tool" },
    key: { name: "Cock Ring Key", desc: "A heavy iron ring that tightens pleasurably around your shaft.", type: "tool" },
    flask: { name: "Cum Flask", desc: "A leather skin for holding hot, sticky fluids.", type: "tool" },
    rope: { name: "Bondage Rope", desc: "Sturdy hemp for tying up lovers or yourself in erotic poses.", type: "tool" },
    apple: { name: "Aphrodisiac Apple", desc: "Juicy fruit that makes your loins burn with desire.", type: "food", pleasure: 30 },
    cauldron: { name: "Ægir's Lust Cauldron", desc: "THE LEGENDARY ARTIFACT! It bubbles with endless orgasmic essence.", type: "quest" }
};

const rooms = {
    home: {
        name: "Sensual Turf Bedroom",
        desc: "The wooden beams creak like moans. A soft bed invites you to stroke yourself. Outside, the wind whispers dirty secrets.",
        exits: { n: 'shore' },
        items: ['photo', 'apple']
    },
    shore: {
        name: "Erotic Black Sand Beach",
        desc: "Waves crash like lovers climaxing against black basalt. A small boat bobs suggestively. To the North, an island pulses with faint, throbbing light.",
        exits: { s: 'home', n: 'grove' },
        items: ['sword']
    },
    grove: {
        name: "Seductive Elf Grove",
        desc: "The air is thick with musk and honey. Hidden nymphs watch, their eyes hungry for your body.",
        exits: { s: 'shore', e: 'cave' },
        npc: 'elf',
        items: []
    },
    cave: {
        name: "Moist Troll Cave",
        desc: "It's dark and dripping wet. The scent of raw, animalistic sex overwhelms you.",
        dark: true,
        exits: { w: 'grove', n: 'volcano' },
        npc: 'troll',
        items: ['key'] // Drops key
    },
    volcano: {
        name: "Hot Volcano Slope",
        desc: "Magma flows like molten cum. The heat makes your skin flush and your desires erupt.",
        exits: { s: 'cave', e: 'spring', u: 'ruins' },
        items: []
    },
    spring: {
        name: "Steamy Hot Spring",
        desc: "Steam rises from the milky water, inviting you to bathe and touch yourself intimately.",
        exits: { w: 'volcano' },
        items: ['flask']
    },
    ruins: {
        name: "Ancient Erotic Ruins",
        desc: "Crumbling arches frame scenes of ancient orgies. A heavy door blocks the way to deeper pleasures.",
        exits: { d: 'hall', d_lock: true },
        items: ['rope']
    },
    hall: {
        name: "Ægir's Pleasure Hall",
        desc: "An underwater cavern of ecstasy, dry by magic. The Sea God's throne throbs with invitation.",
        exits: { u: 'ruins' },
        npc: 'kraken',
        items: ['cauldron']
    }
};

const lovers = {
    troll: { name: "Horny Stone Troll", arousal: 40, pleasure: 10, desc: "A massive, rock-hard creature with a throbbing member blocks your path, eyes lusting for your holes!", active: true, loot: 'key' },
    kraken: { name: "Tentacled Kraken Nymph", arousal: 80, pleasure: 15, desc: "A writhing mass of slippery tentacles guarding the Cauldron, ready to penetrate every orifice!", active: true, loot: null }
};

// --- ENGINE ---

const out = document.getElementById('output');
const inp = document.getElementById('cmd');
const inpArea = document.getElementById('input-area');
const hudEl = document.getElementById('hud');

function updateHUD(){
    if (!hudEl) return;
    hudEl.textContent = `Arousal: ${state.arousal} | Orgasms: ${state.orgasms} | Toys: ${state.inventory.length}/${MAX_INV}`;
}

// Boot Sequence
const bootMessages = [
    "BIOS CHECK... OK",
    "LOADING ÆGIRSON_LUST_OS v69...",
    "MOUNTING EROTIC DRIVERS...",
    "CONNECTING TO ICELANDIC PLEASURE MAINFRAME...",
    "SUCCESS.",
    " ",
    "Welcome, Heir of Ægirson.",
    "Your throbbing destiny: Retrieve the Lust Cauldron for endless ecstasy.",
    "Type 'help' for commands. Get horny!"
];

async function boot() {
    for (let msg of bootMessages) {
        await typeLine(msg, 30);
    }
    loadGame(); // Try auto load
    printRoom();
    updateHUD();
    inpArea.style.display = 'flex';
    inp.focus();
}

function typeLine(text, speed = 20) {
    return new Promise(resolve => {
        const div = document.createElement('div');
        out.appendChild(div);
        let i = 0;
        function type() {
            if (i < text.length) {
                div.textContent += text.charAt(i);
                i++;
                out.scrollTop = out.scrollHeight;
                setTimeout(type, speed);
            } else {
                resolve();
            }
        }
        type();
    });
}

function print(text, cls = '') {
    const div = document.createElement('div');
    if (cls) div.className = cls;
    div.innerHTML = text; // Allow innerHTML for styling spans
    out.appendChild(div);
    out.scrollTop = out.scrollHeight;
}

// --- INPUT HANDLING ---

inp.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const val = inp.value.trim();
        inp.value = '';
        if (val) {
            print(`> ${val}`, 'highlight');
            processCommand(val);
        }
    }
});

// Focus keeper
document.addEventListener('click', () => inp.focus());

// --- PARSER LOGIC ---

function processCommand(raw) {
    if (state.arousal <= 0 && raw.toLowerCase() !== 'restart') {
        print("You've cum too hard... Exhausted. Type 'restart' to get horny again.", 'error');
        return;
    }

    const clean = raw.toLowerCase().split(' ');
    const verb = clean[0];
    const noun = clean.slice(1).join(' ');

    // Lust Check
    const currentRoom = rooms[state.room];
    const loverId = currentRoom.npc;
    if (loverId && lovers[loverId] && lovers[loverId].active && !['fuck', 'seduce', 'thrust', 'use', 'look', 'x', 'i', 'inventory', 'help', 'hint'].includes(verb)) {
        print(`The ${lovers[loverId].name} tempts you with their body! You must fuck!`, 'error');
        return;
    }

    switch (verb) {
        case 'n': case 'north': move('n'); break;
        case 's': case 'south': move('s'); break;
        case 'e': case 'east': move('e'); break;
        case 'w': case 'west': move('w'); break;
        case 'u': case 'up': move('u'); break;
        case 'd': case 'down': move('d'); break;
        case 'go': move(clean[1]?.charAt(0)); break;
        
        case 'l': case 'look': case 'x': case 'examine': look(noun); break;
        case 'i': case 'inv': case 'inventory': showInv(); break;
        case 'get': case 'take': case 'grab': take(noun); break;
        case 'drop': drop(noun); break;
        case 'use': use(noun); break;
        case 'fuck': case 'seduce': case 'thrust': fuck(noun); break;
        case 'talk': talk(noun); break;
        
        case 'map': showMap(); break;
        case 'help': showHelp(); break;
        case 'save': saveGame(); break;
        case 'load': manualLoad(); break;
        case 'restart': location.reload(); break;
        case 'clear': out.innerHTML = ''; break;
        
        default: print("I don't understand that... but it sounds kinky.", 'error');
    }
    
    // Auto-save after meaningful turn
    if (!['save', 'load', 'help', 'map'].includes(verb)) {
        localStorage.setItem(GAME_ID, JSON.stringify(state));
    }
}

// --- ACTIONS ---

function move(dir) {
    const room = rooms[state.room];
    if (!room.exits[dir]) {
        print("You can't thrust that way.");
        return;
    }

    // Logic Checks
    if (state.room === 'shore' && dir === 'n' && !state.inventory.includes('sword') && !state.visited.includes('grove')) {
        print("You row the boat... feeling the rhythm like a lover's hips.");
    }
    
    // Locked Door
    if (state.room === 'ruins' && dir === 'd' && room.exits.d_lock && !state.flags.doorOpen) {
        print("The heavy door teases you, locked tight like a virgin.", 'item');
        return;
    }

    // Dark Room
    const nextRoomId = room.exits[dir];
    const nextRoom = rooms[nextRoomId];
    if (nextRoom.dark && !state.inventory.includes('lantern')) {
        print("It's too dark! You grope blindly, aroused by the unknown.", 'error');
        return;
    }

    // Volcano Heat
    if (nextRoomId === 'volcano' && !state.flags.flaskFilled && !state.visited.includes('volcano')) {
        print("The heat makes your cock throb unbearably!", 'error');
        state.arousal -= 10;
        print(`Arousal: ${state.arousal}/100`);
    }

    state.room = nextRoomId;
    if (!state.visited.includes(nextRoomId)) {
        state.visited.push(nextRoomId);
        state.orgasms += 1; // Orgasms as score
    }
    printRoom();
    updateHUD();
}

function printRoom() {
    const r = rooms[state.room];
    print(`<br><span class="room-title">${r.name}</span>`);
    print(r.desc);
    
    // Items
    if (r.items.length > 0) {
        const names = r.items.map(id => items[id].name).join(', ');
        print(`You see tempting toys: <span class="item">${names}</span>`);
    }
    
    // NPC
    if (r.npc && lovers[r.npc] && lovers[r.npc].active) {
        print(`LUST: ${lovers[r.npc].desc}`, 'error');
    } else if (r.npc === 'elf' && !state.flags.riddleSolved) {
        print("A seductive Elf lounges, her body glistening, waiting to 'talk' dirty.", 'highlight');
    }
    
    print(`Exits: ${Object.keys(r.exits).filter(k => k.length === 1).join(' ').toUpperCase()}`, 'ascii-art');
}

function look(noun) {
    if (!noun) { printRoom(); return; }
    
    // Check Inventory
    const invItem = state.inventory.find(id => items[id].name.toLowerCase().includes(noun) || id === noun);
    // Check Room
    const roomItem = rooms[state.room].items.find(id => items[id].name.toLowerCase().includes(noun) || id === noun);
    
    const id = invItem || roomItem;
    
    if (id) {
        print(items[id].desc);
        if (id === 'photo') { 
            print("You stroke yourself to the image. Arousal surges."); 
            state.arousal = Math.min(100, state.arousal + items.photo.pleasure);
        }
    } else if (noun.includes('elf')) {
        print("The Elf's breasts heave, her lips parted invitingly.");
    } else if (noun.includes('troll')) {
        print("Massive cock, rough skin, ready to pound.");
    } else {
        print("You don't see that... but imagine it naked.");
    }
}

function take(noun) {
    if (state.inventory.length >= MAX_INV) {
        print("Your hands are full of toys!", 'error');
        return;
    }
    
    const r = rooms[state.room];
    const idx = r.items.findIndex(id => items[id].name.toLowerCase().includes(noun) || id === noun);
    
    if (idx > -1) {
        const itemId = r.items[idx];
        if (itemId === 'cauldron') {
            winGame();
            return;
        }
        state.inventory.push(itemId);
        r.items.splice(idx, 1);
        print(`Taken: ${items[itemId].name}. It feels good in your hands.`);
        state.orgasms += 1;
        updateHUD();
    } else {
        print("Can't grab that... unless it's ass.");
    }
}

function drop(noun) {
    const idx = state.inventory.findIndex(id => items[id].name.toLowerCase().includes(noun) || id === noun);
    if (idx > -1) {
        const itemId = state.inventory[idx];
        state.inventory.splice(idx, 1);
        rooms[state.room].items.push(itemId);
        print(`Dropped: ${items[itemId].name}. It lands with a wet slap.`);
        updateHUD();
    } else {
        print("You don't have that... wanna borrow mine?");
    }
}

function use(noun) {
    // Handling "use x on y" is complex, simplifying to "use x" contextually
    const parts = noun.split(' ');
    const itemKey = state.inventory.find(id => items[id].name.toLowerCase().includes(parts[0]) || id === parts[0]);

    if (!itemKey) { print("You don't have that toy."); return; }

    if (itemKey === 'apple') {
        state.arousal = Math.min(100, state.arousal + items.apple.pleasure);
        print("Juicy bites make your body ache with need.");
        state.inventory = state.inventory.filter(i => i !== 'apple');
        updateHUD();
        return;
    }

    if (itemKey === 'flask' && state.room === 'spring') {
        state.flags.flaskFilled = true;
        items.flask.name = "Full Cum Flask";
        print("Flask filled with creamy, warm fluids.");
        state.arousal = 100;
        updateHUD();
        return;
    }

    if (itemKey === 'flask' && state.room === 'volcano') {
        if (state.flags.flaskFilled) {
            print("You pour the sticky fluid on the hot path, making it slick and ready.");
            state.visited.push('volcano'); // Safe now
            items.flask.name = "Empty Flask";
            state.flags.flaskFilled = false;
        } else {
            print("The flask is dry!");
        }
        updateHUD();
        return;
    }

    if (itemKey === 'key' && state.room === 'ruins') {
        state.flags.doorOpen = true;
        print("The ring slides in perfectly. The door opens with a moan.");
        updateHUD();
        return;
    }
    
    if (itemKey === 'rope' && state.room === 'ruins' && state.flags.doorOpen) {
        print("You tie the rope in intricate knots, ready for bondage descent.");
        state.flags.ropeTied = true;
        updateHUD();
        return;
    }

    print("You tease yourself with it, but nothing climaxes.");
}

function talk(noun) {
    if (state.room === 'grove' && !state.flags.riddleSolved) {
        print("Elf: 'I have a stiff shaft. My tip penetrates. I come with a quiver. What am I?' (Type 'answer [word]')");
        // Hacky one-off riddle parser
        state.awaitingRiddle = true;
    } else {
        print("No one whispers back... except your inner slut.");
    }
}

function fuck(noun) {
    const r = rooms[state.room];
    if (!r.npc || !lovers[r.npc].active) {
        print("Nothing to fuck here... except yourself?");
        return;
    }

    if (!state.inventory.includes('sword')) {
        print("You try to grind bare... Risky and hot!", 'error');
        state.arousal -= 10;
    } else {
        const pleasure = items.sword.power + Math.floor(Math.random() * 5);
        lovers[r.npc].arousal -= pleasure;
        print(`You thrust with the dildo sword! (${pleasure} pleasure)`);
    }

    // Lover's Turn
    if (lovers[r.npc].arousal > 0) {
        const lPleasure = lovers[r.npc].pleasure - (Math.floor(Math.random() * 3));
        state.arousal -= lPleasure;
        print(`${lovers[r.npc].name} fucks you back! (-${lPleasure} Arousal)`, 'error');
        print(`Your Arousal: ${state.arousal} | Lover's Arousal: ${lovers[r.npc].arousal}`);
    } else {
        print(`The ${lovers[r.npc].name} cums wildly!`, 'highlight');
        lovers[r.npc].active = false;
        state.orgasms += 1;
        if (lovers[r.npc].loot) {
            r.items.push(lovers[r.npc].loot);
            print(`They drop: ${items[lovers[r.npc].loot].name}`);
        }
    }

    if (state.arousal <= 0) cumExhausted();
    updateHUD();
}

// Special Parser for Riddle Answers
const originalProcess = processCommand;
processCommand = function(raw) {
    if (state.awaitingRiddle) {
        if (raw.toLowerCase().includes('arrow')) {
            print("Elf: 'Mmm, correct. Now let me reward you...'");
            print("The Elf sucks you off and hands you a Lantern.");
            state.inventory.push('lantern');
            state.flags.riddleSolved = true;
            state.awaitingRiddle = false;
            state.arousal += 20;
            return;
        } else {
            print("Elf: 'Wrong... but try again, lover.'");
            state.awaitingRiddle = false;
            return;
        }
    }
    originalProcess(raw);
}

function cumExhausted() {
    print("YOU CUM UNCONTROLLABLY... EXHAUSTED.", 'error');
    print("Press Reload or type 'restart'.");
    localStorage.removeItem(GAME_ID);
}

function winGame() {
    print("YOU CLAIM THE LUST CAULDRON!", 'highlight');
    print("Endless ecstasy surges through your body. Ægir's spirit fucks you eternally.");
    print(`FINAL ORGASMS: ${state.orgasms + 5}/10`);
    print("CLIMAX ACHIEVED!");
    
    // Confetti
    for(let i=0; i<50; i++) {
        let c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random()*100 + 'vw';
        c.style.animationDuration = (Math.random()*2+2) + 's';
        document.body.appendChild(c);
    }
}

// --- UTILS ---

function showMap() {
    // Simple text map
    print("EROTIC MAP:", 'highlight');
    print("   [Ruins] -> (down) -> [Hall]");
    print("      ^");
    print("      | (climb)");
    print("  [Volcano] <-> [Spring]");
    print("      ^");
    print("      |");
    print("   [Cave] <-> [Grove]");
    print("                  ^");
    print("                  |");
    print("               [Shore]");
    print("                  ^");
    print("                  |");
    print("                [Home]");
}

function showHelp() {
    print("KINKY COMMANDS:", 'highlight');
    print("- n, s, e, w, u, d: Move");
    print("- look / l: Ogle around");
    print("- i / inv: Check toys");
    print("- take [item], drop [item]");
    print("- use [item]");
    print("- fuck [lover]");
    print("- talk [npc]");
    print("- map: See fuck spots");
    print("- save / load");
}

function saveGame() {
    localStorage.setItem(GAME_ID, JSON.stringify(state));
    print("Game Saved... Your arousal preserved.");
}

function manualLoad() { loadGame(); printRoom(); }

function loadGame() {
    const saved = localStorage.getItem(GAME_ID);
    if (saved) {
        state = JSON.parse(saved);
        // Restore items/lovers logic if needed
    }
}

// Start
window.onload = boot;

</script>
</body>
</html>